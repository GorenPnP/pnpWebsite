{% extends 'base/main.html' %}
{% load static %}
{% block title %}{{ topic }}{% endblock %}
{% block extra-head %}
<link rel="stylesheet" href="{% static 'base/css/checkbox.css' %}">
<link rel="stylesheet" href="{% static 'mining/css/mining.css' %}">
<script src='https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js' type='text/javascript'></script>
<script src="{% static 'base/js/ajax.js' %}"></script>
<script src="{% static 'mining/js/mining.js' %}"></script>
{% endblock %}
{% block absolute %}{% include 'base/header.html' with topic=topic %}{% endblock %}

{% block body %}
<h2>Kissi flooft im Schmiedesystem</h2>

{% for material in materials %}
<div class="material" data-id="{{ material.id }}" data-src="{{ material.icon.url }}"></div>
{% endfor %}

<div class="field">
	<!-- bg colors of cells -->
	<div class="field-container field-container--bg">
		<div class="cell" data-y_pos="0" data-x_pos="0"></div>
	</div>

	<!-- actual layers -->
	{% for layer in layers %}
	layer
		<div class="field-container field-container--{{ layer.index }}" data-layer_id="{{ layer.id }}">
		{% for row in layer.field %}
			{% for cell in row %}
				<div class="cell"
					data-y_pos="{{ forloop.parentloop.counter0 }}" data-x_pos="{{ forloop.counter0 }}"
					{% if cell %}data-material_id="{{ cell }}"{% endif %}
				></div>
			{% empty %}
				<div class="cell" data-y_pos="{{ forloop.counter0 }}" data-x_pos="0"></div>
			{% endfor %}
		{% empty %}
			<div class="cell" data-y_pos="0" data-x_pos="0"></div>
		{% endfor %}
		</div>
	{% empty %}
		<div class="field-container field-container--0" data-layer_id="0">
			<div class="cell" data-y_pos="0" data-x_pos="0"></div>
		</div>
	{% endfor %}
</div>

<aside class="detail-mine">
	<button id="mining-window">
		<b>Click to Mine!</b>
	</button>
</aside>
<aside>
	<b>Material:</b>
	<span id="current-material">-</span>
	
	<b>Rigidity:</b>
	<span id="current-rigidity">-</span>
</aside>
<aside id="amount-mined"></aside>


<div id="materials" style="display: none">{{ materials }}</div>
<div id="initial_material_id" style="display: none">{{ initial_material_id }}</div>
{% endblock %}
